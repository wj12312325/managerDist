(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24aa324b"],{"0c2b":function(e,t,r){},"48ac":function(e,t,r){},adc4:function(e,t,r){"use strict";r("0c2b")},dc49:function(e,t,r){"use strict";r("48ac")},e382:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"user-container"},[r("el-form",{staticClass:"search",attrs:{inline:""}},[r("el-form-item",[r("el-input",{attrs:{placeholder:"用户名"},model:{value:e.searchObj.name,callback:function(t){e.$set(e.searchObj,"name",t)},expression:"searchObj.name"}})],1),r("el-form-item",[r("el-input",{attrs:{placeholder:"手机号/账号"},model:{value:e.searchObj.phone,callback:function(t){e.$set(e.searchObj,"phone",t)},expression:"searchObj.phone"}})],1),r("el-form-item",[r("el-select",{attrs:{placeholder:"请选择身份"},model:{value:e.searchObj.role,callback:function(t){e.$set(e.searchObj,"role",t)},expression:"searchObj.role"}},e._l(e.roleList,(function(e){return r("el-option",{key:e.role,attrs:{label:e.roleName,value:e.role}})})),1)],1),r("el-button",{staticClass:"btn",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.findUser}},[e._v("查询")]),r("el-button",{staticClass:"btn",attrs:{type:"info"},on:{click:e.resetSearch}},[e._v("清空")])],1),r("el-button",{staticClass:"addBtn",attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.openAdduser}},[e._v("新增用户")]),r("el-dialog",{attrs:{title:e.titleName,visible:e.dialogFormVisible,width:"35%","lock-scroll":!1,"before-close":e.closeDialog},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[r("el-form",{ref:"addOrUpdateUser",staticStyle:{width:"80%"},attrs:{model:e.userInfo,"label-width":"120px",rules:e.addOrUpdateUserRules}},[r("el-form-item",{attrs:{label:"手机号/账号：",prop:"phone"}},[r("el-input",{ref:"phone",attrs:{placeholder:"请输入手机号/账号",autocomplete:"off",name:"phone",type:"text",maxlength:"20"},model:{value:e.userInfo.phone,callback:function(t){e.$set(e.userInfo,"phone",t)},expression:"userInfo.phone"}})],1),r("el-form-item",{attrs:{label:"用户名：",prop:"name"}},[r("el-input",{ref:"name",attrs:{placeholder:"请输入用户名",autocomplete:"off",name:"name",type:"text",maxlength:"16"},model:{value:e.userInfo.name,callback:function(t){e.$set(e.userInfo,"name",t)},expression:"userInfo.name"}})],1),r("el-form-item",{attrs:{label:"密码：",prop:"password"}},[r("el-input",{ref:"password",attrs:{placeholder:e.placeholder,autocomplete:"off",name:"password",type:"password",maxlength:"20"},model:{value:e.userInfo.password,callback:function(t){e.$set(e.userInfo,"password",t)},expression:"userInfo.password"}})],1),"新增用户"==e.titleName?r("el-form-item",{attrs:{label:"确认密码：",prop:"password1"}},[r("el-input",{ref:"password1",attrs:{placeholder:"确认密码",autocomplete:"off",name:"password1",type:"password",maxlength:"20"},model:{value:e.userInfo.password1,callback:function(t){e.$set(e.userInfo,"password1",t)},expression:"userInfo.password1"}})],1):e._e(),r("el-form-item",{attrs:{label:"身份：",prop:"role"}},[r("el-select",{attrs:{placeholder:"请选择身份"},model:{value:e.userInfo.role,callback:function(t){e.$set(e.userInfo,"role",t)},expression:"userInfo.role"}},e._l(e.roleList,(function(e){return r("el-option",{key:e.role,attrs:{label:e.roleName,value:e.role}})})),1)],1),r("el-form-item",{attrs:{label:"用户头像："}},[r("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:"/api/goods/upload",multiple:!1,"show-file-list":!1,"auto-upload":!1,"file-list":e.fileListt,"on-change":e.onChange}},[e.userInfo.user_img?r("img",{staticClass:"avatar",attrs:{src:e.userInfo.user_img}}):r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.closeDialog}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addOrUpdateUser("addOrUpdateUser")}}},[e._v("确 定")])],1)],1),r("el-table",{staticClass:"userTable",attrs:{data:e.userList,border:"",stripe:""}},[r("el-table-column",{attrs:{prop:"user_img",label:"用户头像",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:""+e.srcUrl+a.user_img}})]}}])}),r("el-table-column",{attrs:{prop:"name",label:"用户名",align:"center"}}),r("el-table-column",{attrs:{prop:"phone",label:"手机号/账号",align:"center"}}),r("el-table-column",{attrs:{prop:"role",label:"用户身份",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(" "+e._s(e.roleName(r))+" ")]}}])}),r("el-table-column",{attrs:{label:"用户收货地址",align:"center",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"primary",icon:"el-icon-location",plain:""},on:{click:function(t){return e.toAddress(a)}}},[e._v("查看收货地址")])]}}])}),r("el-table-column",{attrs:{label:"用户购物车",align:"center",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"primary",icon:"el-icon-shopping-cart-2",plain:""},on:{click:function(t){return e.toCart(a)}}},[e._v("查看购物车")])]}}])}),r("el-table-column",{attrs:{label:"用户订单",align:"center",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"primary",icon:"el-icon-s-order",plain:""},on:{click:function(t){return e.toOrder(a)}}},[e._v("查看订单")])]}}])}),r("el-table-column",{attrs:{label:"设置",align:"center",width:"230"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.openUpdateUser(a)}}},[e._v("修改")]),r("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.deleteUser(a)}}},[e._v("删除")])]}}])})],1),r("div",{staticClass:"pagination"},[r("el-pagination",{attrs:{"current-page":e.pageNum,"pager-count":5,"page-sizes":[3,5,7],"page-size":e.pageSize,layout:" prev, pager,  next, sizes,jumper,->,total",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.getUserList}})],1)],1)},s=[],n=r("5530"),o=r("c7eb"),i=r("1da1"),l=(r("ac1f"),r("00b4"),r("b0c0"),r("d3b7"),r("3ca3"),r("ddb0"),r("2b3d"),r("9861"),r("2f62")),c={name:"User",data:function(){var e=this,t=function(e,t,r){var a=/^[\u4E00-\u9FA5A-Za-z0-9_]+$/;t?a.test(t)?r():r(new Error("用户名要求1~16之间，不包括特殊字符")):r(new Error("用户名不能为空！"))},r=function(t,r,a){""===r?a(new Error("请再次输入密码")):r!==e.userInfo.password?a(new Error("两次输入密码不一致！")):a()},a=function(e,t,r){var a=/^[0-9A-Za-z]{4,20}$/;t.length<4?r(new Error("手机号/账号不能少于4位")):a.test(t)?r():r(new Error("手机号/账号长度要求在4~20之间，不包括特殊字符"))},s=function(e,t,r){""===t?r(new Error("身份不能为空")):r()};return{searchObj:{name:"",phone:"",role:""},tempSearchObj:{name:"",phone:"",role:""},roleList:[{role:0,roleName:"用户"},{role:1,roleName:"商家"},{role:2,roleName:"管理员"}],userInfo:{name:"",phone:"",role:"",user_img:"".concat(this.srcUrl,"bda7bfb516d8490e40f8ba500.webp"),password:"",password1:"",id:0},fileListt:[],avatarImg:"bda7bfb516d8490e40f8ba500.webp",pageNum:1,pageSize:5,titleName:"新增用户",dialogFormVisible:!1,addOrUpdateUserRules:{name:[{required:!0,trigger:"blur",validator:t}],password:[{required:!0,trigger:"blur",validator:function(t,r,a){if("新增用户"==e.titleName){var s=/^[0-9A-Za-z]{4,20}$/;r?s.test(r)?a():a(new Error("密码长度要求在4~20之间，不包括特殊字符")):a(new Error("密码不能为空！"))}else{var n=/^[0-9A-Za-z]{4,20}$/;0==r.length?a():r.length>0&&r.length<4?a(new Error("密码长度不能少于4位")):n.test(r)?a():a(new Error("密码长度要求在4~20之间，不包括特殊字符"))}}}],password1:[{required:!0,trigger:"blur",validator:r}],phone:[{required:!0,trigger:"blur",validator:a}],role:[{required:!0,trigger:"blur",validator:s}]}}},mounted:function(){this.getUserList()},methods:{getUserList:function(){var e=arguments,t=this;return Object(i["a"])(Object(o["a"])().mark((function r(){var a,s,n,i,l,c,u,p,d,f;return Object(o["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:1,t.pageNum=a,s=t.pageSize,n=t.pageNum,i=t.state,l=void 0===i?1:i,c=t.tempSearchObj,u=c.name,p=c.role,d=c.phone,f={pageSize:s,pageNum:n,state:l},u&&Object.assign(f,{name:u}),p&&Object.assign(f,{role:p}),d&&Object.assign(f,{phone:d}),r.prev=8,r.next=11,t.$store.dispatch("user/getUserList",f);case 11:t.$message({type:"success",message:"获取用户列表成功"}),r.next=17;break;case 14:r.prev=14,r.t0=r["catch"](8),t.$message({type:"error",message:r.t0});case 17:case"end":return r.stop()}}),r,null,[[8,14]])})))()},handleSizeChange:function(e){this.pageSize=e,this.getUserList()},findUser:function(){var e=this.searchObj,t=e.name,r=e.phone,a=e.role;this.tempSearchObj={name:t,phone:r,role:1*a},this.getUserList()},resetSearch:function(){this.searchObj={name:"",phone:"",role:""},this.tempSearchObj={name:"",phone:"",role:""},this.getUserList()},closeDialog:function(){this.dialogFormVisible=!1,this.userInfo.name="",this.userInfo.user_img="",this.userInfo.phone="",this.userInfo.role="",this.userInfo.id="",this.$refs.addOrUpdateUser.resetFields()},onChange:function(e,t){this.userInfo.user_img=URL.createObjectURL(e.raw),this.$refs.upload.clearFiles();var r=t[t.length-1];this.fileListt=[r],e.response&&(this.avatarImg=e.response.result.goodsImg)},openAdduser:function(){this.dialogFormVisible=!0,this.titleName="新增用户",this.userInfo.name="",this.userInfo.phone="",this.userInfo.password="",this.userInfo.password1="",this.userInfo.user_img="".concat(this.srcUrl,"bda7bfb516d8490e40f8ba500.webp")},addOrUpdateUser:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(i["a"])(Object(o["a"])().mark((function e(r){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}return e.next=3,t.$refs.upload.submit();case 3:setTimeout(Object(i["a"])(Object(o["a"])().mark((function e(){var r,a,s,i,l,c,u,p;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,t.userInfo.user_img=t.avatarImg,r=t.userInfo,a=r.phone,s=r.password,i=r.name,l=r.role,c=r.user_img,u={name:i,phone:a,password:s,role:l,user_img:c},"新增用户"!=t.titleName){e.next=9;break}return e.next=7,t.$store.dispatch("user/addUser",u);case 7:e.next=13;break;case 9:return""==u.password&&delete u.password,p=Object(n["a"])({id:t.userInfo.id},u),e.next=13,t.$store.dispatch("user/updateUser",p);case 13:t.$message({type:"success",message:"".concat(t.titleName,"成功")}),t.getUserList(),e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](0),t.$message({type:"error",message:e.t0});case 20:case"end":return e.stop()}}),e,null,[[0,17]])}))),500),t.dialogFormVisible=!1;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},roleName:function(e){return 0==e.role?"用户":1==e.role?"商家":"管理员"},toAddress:function(e){this.$router.push({path:"/address/index",query:{user_id:e.id}})},toCart:function(e){this.$router.push({path:"/cart/index",query:{user_id:e.id}})},toOrder:function(e){this.$router.push({path:"/order/index",query:{user_id:e.id}})},openUpdateUser:function(e){this.dialogFormVisible=!0,this.titleName="修改用户",this.userInfo.phone=e.phone,this.userInfo.password="",this.userInfo.name=e.name,this.userInfo.user_img=this.srcUrl+e.user_img,this.userInfo.role=e.role,this.userInfo.id=e.id},deleteUser:function(e){var t=this;return Object(i["a"])(Object(o["a"])().mark((function r(){return Object(o["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$confirm("确定删除 '".concat(e.name,"' 吗?"),"提示",{type:"warning"}).then(Object(i["a"])(Object(o["a"])().mark((function r(){var a;return Object(o["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$store.dispatch("user/deleteUser",e.id);case 2:a=r.sent,t.getUserList(1===t.userList.length?t.pageNum-1:t.pageNum),t.$message.success(a.message||"删除成功!");case 5:case"end":return r.stop()}}),r)})))).catch((function(e){"cancel"==e?t.$message.info("已取消删除"):t.$message({type:"error",message:e})}));case 1:case"end":return r.stop()}}),r)})))()}},computed:Object(n["a"])(Object(n["a"])({},Object(l["c"])({userList:function(e){return e.user.userList},total:function(e){return e.user.total}})),{},{placeholder:function(){return"新增用户"==this.titleName?"请输入密码":"为空代表不修改"}})},u=c,p=(r("dc49"),r("adc4"),r("2877")),d=Object(p["a"])(u,a,s,!1,null,"ff302686",null);t["default"]=d.exports}}]);